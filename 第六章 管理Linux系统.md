### 管理Linux系统



**6**  设备

**7**  */proc*文件系统

**8**  Linux系统调用

**9**  内联汇编代码

**10** 安全

**11** GNU/Linux示例程序







### 6 设备

Linux系统像其他操作系统一样，内部通过叫做**设备驱动**的模块化的软件组件与硬件进行通信。设备驱动隐藏了操作系统与硬件通信的协议具体细节，同时给系统提供了标准的接口与硬件设备进行通信。

Linux系统下，设备驱动是内核的一部分，既能以静态链接的方式加入内核，也可以按需加载的方式成为内核模块。设备驱动以内核的一部分来运行，并且不会直接访问用户进程。但是Linux系统提供了可以和设备驱动通信的机制—通过一个"类文件对象"—操作硬件。这些文件对象都出现在文件系统中，并且程序也能打开这些文件对象，也可以像正常文件一样进行写操作。无论是通过Linux提供的低级I/O操作还是标准C语言库的I/O操作，都可以通过操作这些"类文件对象"与硬件通信。

Linux也提供几个类文件对象来直接与Linux内核通信，而不是通过设备驱动与Linux内核通信。这些文件不直接与硬件相链接。而是提供多种专门的接口给应用和系统程序。

> **访问设备时要小心!**
>
> 这章讲的技术是直接访问正运行在Linux内核中的设备驱动，并且通过它们来访问连接到系统内的硬件。使用这些技术时需要小心，如果滥用可能会损坏GNU/Linux系统。
>
> *详情看侧边 "块设备的危害"。

### 6.1 设备类型

设备文件不同于普通文件—它们并不是在文件系统中的一块在磁盘上的数据区域。向设备文件中读取与写入数据相当于与对应的设备驱动通信，再由设备驱动到底层设备。设备文件有二种形态:

- `字符设备`表示这是可以读取或者写入一系列数据字节流的硬件设备。串行和并行接口，磁带设备，终端设备，还有声卡都属于字符设备。
- `块设备`表示这是可以在固定大小的块内读写数据的硬件设备。不像字符设备，块设备提供对存储在设备数据中随机访问功能。磁盘驱动器就是一个块设备。

平常的应用程序都不会用到块设备。虽然磁盘驱动器是块设备，但是每个磁盘分区里的内容通常都包含一个文件系统，同时这个文件系统挂载在GNU/Linux根文件系统树上。只有实现文件系统的内核代码才需要直接访问块设备;应用程序访问磁盘上的内容都是通过标准文件和目录来完成。







